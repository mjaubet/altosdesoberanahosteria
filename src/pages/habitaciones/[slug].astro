---
import Layout from '../../layouts/Layout.astro';
import { Check } from 'lucide-react';
import PageHero from '../../components/PageHero';
import RoomGallery from '../../components/RoomGallery';

const { slug } = Astro.params;

// Fetch all rooms
const rooms = await Astro.glob('../../content/rooms/*.json');
const room = rooms.find((r) => r.slug === slug);

if (!room) {
    return Astro.redirect('/404');
}
---

<Layout
    title={room.title}
    image={room.gallery[0]?.image}
>
    <PageHero
        title={room.title}
        image={room.gallery[0]?.image}
        client:load
    />

    <div class="py-20 container mx-auto px-6">
        <div class="flex flex-col lg:flex-row gap-16">
            {/* Left: Gallery Grid */}
            <div class="lg:w-3/5">
                <RoomGallery
                    client:load
                    images={room.gallery}
                />
            </div>

            {/* Right: Info Sticky */}
            <div class="lg:w-2/5">
                <div class="sticky top-32">
                    <span
                        class="text-patagonia-lake font-bold tracking-widest uppercase text-xs mb-3 block"
                        >Detalles de la Habitaci√≥n</span
                    >
                    <h1
                        class="text-4xl font-serif text-patagonia-deep mb-6 leading-tight"
                    >
                        {room.title}
                    </h1>

                    <div
                        class="prose prose-stone text-stone-600 mb-8 font-light text-lg"
                    >
                        {room.longDescription}
                    </div>

                    <div
                        class="mb-10 p-6 bg-patagonia-snow/50 rounded-lg border border-patagonia-sand/30"
                    >
                        <h3 class="font-serif text-lg mb-4 text-patagonia-deep">
                            Comodidades
                        </h3>
                        <ul
                            class="grid grid-cols-1 sm:grid-cols-2 gap-y-3 gap-x-4"
                        >
                            {
                                room.amenities.map((item: string) => (
                                    <li class="flex items-center gap-3 text-stone-600 text-sm">
                                        <span class="p-1 bg-white rounded-full text-patagonia-deep shadow-sm">
                                            <Check size={12} />
                                        </span>
                                        {item}
                                    </li>
                                ))
                            }
                        </ul>
                    </div>

                    {/* Updated Availability Section */}
                    <div>
                        <h3
                            class="font-serif text-xl border-b border-patagonia-sand/30 pb-2 mb-6 text-center text-patagonia-deep"
                        >
                            Consultar Disponibilidad
                        </h3>
                        <div class="grid grid-cols-2 gap-4">
                            {/* Email Button */}
                            <a
                                href="/contacto"
                                class="inline-flex justify-center items-center py-3 px-4 bg-patagonia-deep text-white font-medium rounded-lg hover:bg-patagonia-lake transition-colors shadow-md text-sm md:text-base text-center"
                            >
                                Por Email
                            </a>

                            {/* WhatsApp Button */}
                            <a
                                href={`https://wa.me/5492966685111?text=Hola,%20quisiera%20consultar%20disponibilidad%20para%20la%20${encodeURIComponent(room.title)}`}
                                target="_blank"
                                rel="noopener noreferrer"
                                class="inline-flex justify-center items-center py-3 px-4 bg-[#25D366] text-white font-medium rounded-lg hover:bg-[#20bd5a] transition-colors shadow-md text-sm md:text-base text-center"
                            >
                                WhatsApp
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</Layout>
